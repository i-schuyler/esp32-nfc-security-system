; platformio.ini
; ESP32 NFC Security System (V1)
; M0 scaffolding: build plumbing + embedded SPA from flash + status API

[platformio]
default_envs = esp32dev

[env:esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
board_build.partitions = partitions.csv

; File system for embedded SPA
board_build.filesystem = littlefs

; Conservative flags (avoid surprise behavior)
build_flags =
  -D WSS_FEATURE_WIFI=1
  -D WSS_FEATURE_WEB=1
  -D WSS_FEATURE_NFC=1
  -D WSS_FEATURE_SD=1
  -D WSS_FEATURE_RTC=1

lib_deps =
  bblanchon/ArduinoJson@^7.0.4
  adafruit/Adafruit PN532@1.3.4
  adafruit/Adafruit BusIO@1.17.4
  greiman/SdFat@2.2.2
  adafruit/RTClib@^2.1.4

; NOTE:
; - Upload firmware: pio run -t upload
; - Upload web UI (LittleFS): pio run -t uploadfs

[env:diagnostic_esp32dev]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
src_dir = src_diagnostics
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
build_flags =
  -D WSS_DIAGNOSTIC=1
  -D WSS_DIAG_TARGET_ESP32S3=0
  -D WSS_DIAG_I2C_SDA=21
  -D WSS_DIAG_I2C_SCL=22
  -D WSS_DIAG_SPI_SCK=18
  -D WSS_DIAG_SPI_MISO=19
  -D WSS_DIAG_SPI_MOSI=23
  -D WSS_DIAG_SD_CS=13
  -D WSS_DIAG_PN532_UART_RX=16
  -D WSS_DIAG_PN532_UART_TX=17
lib_deps =
  greiman/SdFat@2.2.2

[env:diagnostic_esp32s3]
platform = espressif32
; NOTE: Board id is [TENTATIVE] for ESP32-S3-DEV-KIT-N32R16V-M.
board = esp32-s3-devkitc-1
framework = arduino
monitor_speed = 115200
src_dir = src_diagnostics
board_build.partitions = partitions.csv
board_build.filesystem = littlefs
build_flags =
  -D WSS_DIAGNOSTIC=1
  -D WSS_DIAG_TARGET_ESP32S3=1
  -D WSS_DIAG_I2C_SDA=8
  -D WSS_DIAG_I2C_SCL=9
  -D WSS_DIAG_SPI_SCK=12
  -D WSS_DIAG_SPI_MISO=11
  -D WSS_DIAG_SPI_MOSI=10
  -D WSS_DIAG_SD_CS=13
  -D WSS_DIAG_PN532_UART_RX=-1
  -D WSS_DIAG_PN532_UART_TX=-1
lib_deps =
  greiman/SdFat@2.2.2
